{% extends "base.html" %}

{% block title %}Perfil{% endblock %} 

{% block content %}
  <div class="container" >
    <div  style=" flex-direction: row; justify-content: center; align-items: center; padding-top: 10%;">
      
      <form method="POST" action="{% url 'projetos' %}">{% csrf_token %}
      <div class="form-group row">
        <label for="nome_inst" class="col-4 col-form-label">Nome da instituição</label> 
        <div class="col-8">
          <input id="nome_inst" name="nome_inst" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="logradouro" class="col-4 col-form-label">Logradouro</label> 
        <div class="col-8">
          <input id="logradouro" name="logradouro" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="numero" class="col-4 col-form-label">Número</label> 
        <div class="col-8">
          <input id="numero" name="numero" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="bairro" class="col-4 col-form-label">Bairro</label> 
        <div class="col-8">
          <input id="bairro" name="bairro" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="cidade" class="col-4 col-form-label">Cidade</label> 
        <div class="col-8">
          <input id="cidade" name="cidade" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
    <label for="estado" class="col-4 col-form-label">Estado</label> 
      <div class="col-8">
        <select id="estado" name="estado" class="custom-select">
            <option value=""></option>
            <option value="SC">SC</option>
            <option value="RS">RS</option>
            <option value="PR">PR</option>
          </select>
        </div>
      </div>
      </div>
      <div class="form-group row">
        <label for="telefone" class="col-4 col-form-label">Telefone</label> 
        <div class="col-8">
          <input id="telefone" name="telefone" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="fax" class="col-4 col-form-label">Fax</label> 
        <div class="col-8">
          <input id="fax" name="fax" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="site" class="col-4 col-form-label">Site</label> 
        <div class="col-8">
          <input id="site" name="site" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="email_inst" class="col-4 col-form-label">Email da instituição</label> 
        <div class="col-8">
          <input id="email_inst" name="email_inst" type="text" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <label for="nome_dirigente" class="col-4 col-form-label">Nome do dirigente</label> 
        <div class="col-8">
          <input id="nome_dirigente" name="nome_dirigente" type="text" class="form-control">
        </div>
      </div> 
      <div class="form-group row">
        <div class="offset-4 col-8">
          <button name="submit" type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </div>
      </div>
    </form>
  </div>
 
  <script type="text/javascript">
     $(document).ready(() => {
      $('#cep').mask('99999-999');
      $('#telefone').mask('(99) 9 9999-9999');
      $('#fax').mask('(99) 9999-9999');
      
      let formClear = () => {
          // Limpa valores do formulário de cep.
          $("#street").val("");
          $("#district").val("");
          $("#city").val("");
          $("#state").val("");
      }
      
      //Quando o campo cep perde o foco.
      $("#cep").blur(() => {

          //Nova variável "cep" somente com dígitos.
          let zipCode = $('#cep').val().replace(/\D/g, '');

          //Verifica se campo cep possui valor informado.
          if (zipCode != "") {

              //Expressão regular para validar o CEP.
              let validCep = /^[0-9]{8}$/;

              //Valida o formato do CEP.
              if(validCep.test(zipCode)) {

                  //Preenche os campos com "..." enquanto consulta webservice.
                  $("#rua").val("...");
                  $("#bairro").val("...");
                  $("#cidade").val("...");
                  $("#uf").val("...");
                  $("#ibge").val("...");

                  //Consulta o webservice viacep.com.br/
                  $.getJSON(`https://viacep.com.br/ws/${zipCode}/json/?callback=?`, data => {

                      if (!("erro" in data)) {
                          //Atualiza os campos com os valores da consulta.
                          $("#street").val(data.logradouro);
                          $("#district").val(data.bairro);
                          $("#city").val(data.localidade);
                          $("#state").val(data.uf);
                      } //end if.
                      else {
                          //CEP pesquisado não foi encontrado.
                          formClear();
                          alert("CEP não encontrado.");
                      }
                  });
              } //end if.
              else {
                  //cep é inválido.
                  formClear();
                  alert("Formato de CEP inválido.");
              }
          } //end if.
          else {
              //cep sem valor, limpa formulário.
              formClear();
          }
      });
  });

  </script>
{% endblock %}
